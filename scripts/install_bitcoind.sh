#!/usr/bin/env bash

set -ev
# The sha is generated by crane https://github.com/google/go-containerregistry/tree/main/cmd/crane 
# crane digest ruimarinho/bitcoin-core:0.21.0
# sha256:2363b3a37b6b29f0a25d6764e264081854e245336d7b1219deeeb09d66650d24
BITCOIND_VERSION=${BITCOIN_VERSION:-0.20.1}
BITCOIND_OCI_SHA=${BITCOIN_OCI_SHA:=sha256:fbf95b4134cd2f35a3cfe3c26feb89e72103234220fd7f2804ec9d3d91880a2b}

docker pull ruimarinho/bitcoin-core@${BITCOIND_OCI_SHA}
CONTAINER_ID=$(docker create ruimarinho/bitcoin-core@${BITCOIND_OCI_SHA})
sudo docker cp $CONTAINER_ID:/opt/bitcoin-${BITCOIND_VERSION}/bin/bitcoind /usr/local/bin/bitcoind
docker rm ${CONTAINER_ID}
